

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Installation &mdash; BIDSonym 0.0.4+43.g91e5e83 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="usage.html" />
    <link rel="prev" title="BIDSonym" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> BIDSonym
          

          
          </a>

          
            
            
              <div class="version">
                0.0.4+43.g91e5e83
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Singularity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-a-singularity-image-singularity-version-2-5">Preparing a Singularity image (Singularity version &gt;= 2.5)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Preparing a Singularity image (Singularity version &lt; 2.5)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-a-singularity-image">Running a Singularity Image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bare-metal-version-python-3-6">Bare metal version (Python 3.6+)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#external-dependencies">External Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#previous-image-versions-on-osf">Previous image versions on OSF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_details.html">Processing details</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs of BIDSonym</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">An usage example</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Contributing to BIDSonym</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing <em>BIDSonym</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">What’s new</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BIDSonym</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="id1">
<h1>Installation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>In general, there are two distinct ways to install and use <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code>:
either through virtualization/container technology, that is <a class="reference internal" href="#docker">Docker</a> or
<a class="reference external" href="https://github.com/singularityware/singularity">Singularity</a>, or in a <a class="reference internal" href="#bare-metal-version-python-3-6">Bare metal version (Python 3.6+)</a>.
Using a container method is highly recommended as they entail entire operating systems through kernel level virtualization and
thus include all software necessary to run <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code>, while at the same time presenting a lightweight alternative to virtual machines.
Once you are ready to run <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code>, see <a class="reference external" href="./usage.rst">Usage</a> for details.</p>
<section id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>In order to run <code class="docutils literal notranslate"><span class="pre">`BIDSonym`</span></code> in a Docker container, Docker must be <a class="reference external" href="https://docs.docker.com/engine/installation/">installed</a> on your system.
Once Docker is installed, you can get <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> through running the following
command in the terminal of your choice:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker pull peerherholz/bidsonym:version
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">version</span></code> is the specific version of <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> you would like to use. For example, if you want
to employ the <code class="docutils literal notranslate"><span class="pre">latest</span></code>/most up to date <code class="docutils literal notranslate"><span class="pre">version</span></code> you can either run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker pull peerherholz/bidsonym:latest
</pre></div>
</div>
<p>or the same command withouth the <code class="docutils literal notranslate"><span class="pre">:latest</span></code> tag, as <code class="docutils literal notranslate"><span class="pre">Docker</span></code> searches for the <code class="docutils literal notranslate"><span class="pre">latest</span></code> tag by default.
However, as the <code class="docutils literal notranslate"><span class="pre">latest</span></code> version is subject to changes and not necessarily in synch with the most recent <code class="docutils literal notranslate"><span class="pre">numbered</span> <span class="pre">version</span></code>, it
is recommend to utilize the latter to ensure reproducibility. For example, if you want to employ <code class="docutils literal notranslate"><span class="pre">BIDSonym</span> <span class="pre">v0.0.4</span></code> the command would look as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker pull peerherholz/bidsonym:v0.0.4
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of November 2020, <a class="reference external" href="https://www.docker.com/pricing/retentionfaq">images older than 6 months will be deleted from Dockerhub</a>. As this is very problematic for everything
reproducibility and version control, every version of the <code class="docutils literal notranslate"><span class="pre">BIDSonym</span> <span class="pre">images</span></code> are additionally
uploaded on <a class="reference external" href="https://osf.io/x4dku/">OSF</a> and can be installed as outlined further below.</p>
</div>
<p>After the command finished (it may take a while depending on your internet connection),
you can run <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run -ti --rm <span class="se">\</span>
    -v path/to/your/bids_dataset:/bids_dataset:ro <span class="se">\</span>
    peerherholz/bidsonym:latest <span class="se">\</span>
    /bids_dataset <span class="se">\</span>
    participant <span class="se">\</span>
    --participant_label label <span class="se">\</span>
    --deid defacing_algorithm <span class="se">\</span>
</pre></div>
</div>
<p>Please have a look at the examples under <a class="reference external" href="./usage.rst">Usage</a> to get more information
about and familiarize yourself with <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code>’s functionality.</p>
</section>
<section id="id3">
<h2>Singularity<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>For security reasons, many HPCs (e.g., TACC) do not allow Docker containers, but support
allow <a class="reference external" href="https://github.com/singularityware/singularity">Singularity</a> containers. Depending
on the <code class="docutils literal notranslate"><span class="pre">Singularity</span></code> version available to you, there are two options to get <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> as
a <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">image</span></code>.</p>
<section id="preparing-a-singularity-image-singularity-version-2-5">
<h3>Preparing a Singularity image (Singularity version &gt;= 2.5)<a class="headerlink" href="#preparing-a-singularity-image-singularity-version-2-5" title="Permalink to this headline">¶</a></h3>
<p>If the version of Singularity on your HPC is modern enough you can create a <code class="docutils literal notranslate"><span class="pre">Singularity</span>
<span class="pre">image</span></code> directly on the HCP.
This is as simple as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ singularity build /my_images/bidsonym-&lt;version&gt;.simg docker://peerherholz/bidsonym:&lt;version&gt;
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;version&gt;</span></code> should be replaced with the desired version of <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> that you want to download.
For example, if you want to use <code class="docutils literal notranslate"><span class="pre">BIDSonym</span> <span class="pre">v0.0.4</span></code>, the command would look as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ singularity build /my_images/bidsonym-v0.0.4.simg docker://peerherholz/bidsonym:v0.0.4
</pre></div>
</div>
</section>
<section id="id5">
<h3>Preparing a Singularity image (Singularity version &lt; 2.5)<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>In this case, start with a machine (e.g., your personal computer) with <code class="docutils literal notranslate"><span class="pre">Docker</span></code> installed and
the use <a class="reference external" href="https://github.com/singularityware/docker2singularity">docker2singularity</a> to
create a <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">image</span></code>. You will need an active internet connection and some time.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run --privileged -t --rm <span class="se">\</span>
    -v /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    -v /absolute/path/to/output/folder:/output <span class="se">\</span>
    singularityware/docker2singularity <span class="se">\</span>
    peerherholz/bidsonym:&lt;version&gt;
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;version&gt;</span></code> should be replaced with the desired version of <code class="docutils literal notranslate"><span class="pre">`BIDSonym`</span></code> that you want
to download and <code class="docutils literal notranslate"><span class="pre">/absolute/path/to/output/folder</span></code> with the absolute path where the created <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">image</span></code>
should be stored. Sticking with the example of <code class="docutils literal notranslate"><span class="pre">BIDSonym</span> <span class="pre">v0.0.4</span></code> this would look as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run --privileged -t --rm <span class="se">\</span>
    -v /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    -v /absolute/path/to/output/folder:/output <span class="se">\</span>
    singularityware/docker2singularity <span class="se">\</span>
    peerherholz/bidsonym:v0.0.4
</pre></div>
</div>
<p>Beware of the back slashes, expected for Windows systems. The above command would translate to Windows systems as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run --privileged -t --rm <span class="se">\</span>
    -v /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    -v D:<span class="se">\h</span>ost<span class="se">\p</span>ath<span class="se">\w</span>here<span class="se">\t</span>o<span class="se">\o</span>utput<span class="se">\s</span>ingularity<span class="se">\i</span>mage:/output <span class="se">\</span>
    singularityware/docker2singularity <span class="se">\</span>
    peerherholz/bidsonym:&lt;version&gt;
</pre></div>
</div>
<p>You can then transfer the resulting <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">image</span></code> to the HPC, for example, using <code class="docutils literal notranslate"><span class="pre">scp</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ scp peerherholz_bidsonym&lt;version&gt;.simg &lt;user&gt;@&lt;hcpserver.edu&gt;:/my_images
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;version&gt;</span></code> should be replaced with the version of <code class="docutils literal notranslate"><span class="pre">`BIDSonym`</span></code> that you used to create the <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">image</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;user&gt;</span></code>
with your <code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">name</span></code> on the HPC and <code class="docutils literal notranslate"><span class="pre">&lt;hcpserver.edu&gt;</span></code> with the address of the HPC.</p>
</section>
<section id="running-a-singularity-image">
<h3>Running a Singularity Image<a class="headerlink" href="#running-a-singularity-image" title="Permalink to this headline">¶</a></h3>
<p>If the data to be preprocessed is also on the HPC, you are ready to run bidsonym.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ singularity run --cleanenv /my_images/bidsonym-&lt;version&gt;.simg <span class="se">\</span>
    path/to/your/bids_dataset <span class="se">\</span>
    participant <span class="se">\</span>
    --participant-label label <span class="se">\</span>
    --deid defacing_algorithm
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to check the name of the created <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">image</span></code> as that might
diverge based on the method you used. Here and going forward it is assumed that you used <code class="docutils literal notranslate"><span class="pre">Singularity</span> <span class="pre">&gt;=</span> <span class="pre">2.5</span></code>
and thus <code class="docutils literal notranslate"><span class="pre">bidsonym-&lt;version&gt;.simg</span></code> instead of <code class="docutils literal notranslate"><span class="pre">peerherholz_bidsonym&lt;version&gt;.simg</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Singularity by default <a class="reference external" href="https://github.com/singularityware/singularity/issues/445">exposes all environment variables from the host inside
the container</a>.
Because of this your host libraries (such as nipype) could be accidentally used
instead of the ones inside the container - if they are included in <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>.
To avoid such situation we recommend using the <code class="docutils literal notranslate"><span class="pre">--cleanenv</span></code> singularity flag
in production use. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ singularity run --cleanenv /my_images/bidsonym-&lt;version&gt;.simg \
    path/to/your/bids_dataset \
    participant \
    --participant-label label \
    --deid defacing_algorithm
</pre></div>
</div>
<p>or, unset the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> variable before running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ unset PYTHONPATH; singularity /my_images/bidsonym-&lt;version&gt;.simg \
    path/to/your/bids_dataset \
    participant \
    --participant-label label \
    --deid defacing_algorithm
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on how <code class="docutils literal notranslate"><span class="pre">Singularity</span></code> is configured on your cluster it might or might not
automatically <code class="docutils literal notranslate"><span class="pre">bind</span></code> (<code class="docutils literal notranslate"><span class="pre">mount</span></code> or <code class="docutils literal notranslate"><span class="pre">expose</span></code>) <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">folders</span></code> to the container.
If this is not done automatically you will need to <code class="docutils literal notranslate"><span class="pre">bind</span></code> the necessary folders using
the <code class="docutils literal notranslate"><span class="pre">-B</span> <span class="pre">&lt;host_folder&gt;:&lt;container_folder&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">Singularity</span></code> argument.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ singularity run --cleanenv -B path/to/bids_dataset/on_host:/bids_dataset \
    /my_images/bidsonym-&lt;version&gt;.simg \
    bids_dataset \
    participant \
    --participant-label label \
    --deid defacing_algorithm
</pre></div>
</div>
</div>
</section>
</section>
<section id="bare-metal-version-python-3-6">
<h2>Bare metal version (Python 3.6+)<a class="headerlink" href="#bare-metal-version-python-3-6" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This method is not recommended! Make sure you would rather do this than
use a <a class="reference internal" href="#docker">Docker</a> or a <a class="reference external" href="https://github.com/singularityware/singularity">Singularity</a>.</p>
</div>
<p>Make sure all of <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code>’s <a class="reference internal" href="#external-dependencies">External Dependencies</a> are installed.
These tools must be installed and their binaries available in the
system’s <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.
A relatively interpretable description of how your environment can be set-up
is found in the <a class="reference external" href="https://github.com/peerherholz/bidsonym/blob/master/Dockerfile">Dockerfile</a>.</p>
<p>On a functional Python 3.6 (or above) environment with <code class="docutils literal notranslate"><span class="pre">pip</span></code> installed,
<code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> can be installed using the habitual command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install bidsonym
</pre></div>
</div>
<p>Check your installation with the <code class="docutils literal notranslate"><span class="pre">--version</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ bidsonym --version
</pre></div>
</div>
<section id="external-dependencies">
<h3>External Dependencies<a class="headerlink" href="#external-dependencies" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> is written using Python 3.6 (or above).
It requires some other neuroimaging software tools that are
not handled by the Python’s packaging system (Pypi) used to deploy
the <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> package:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/">FSL</a> (version 5.0.9)</p></li>
<li><p><a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/mri_deface">MRI_deface</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipy/quickshear">Quickshear</a></p></li>
<li><p><a class="reference external" href="https://github.com/mih/mridefacer">mridefacer</a></p></li>
<li><p><a class="reference external" href="https://github.com/bids-standard/bids-validator">bids-validator</a> (version 1.2.3)</p></li>
</ul>
</section>
<section id="previous-image-versions-on-osf">
<h3>Previous image versions on OSF<a class="headerlink" href="#previous-image-versions-on-osf" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, Dockerhub introduced the deletion of images older than 6 months.
Thus all previous versions of the <code class="docutils literal notranslate"><span class="pre">BIDSonym</span></code> <code class="docutils literal notranslate"><span class="pre">Docker</span></code> image can be found on <a class="reference external" href="https://osf.io/x4dku/">OSF</a>.
After downloading and unzipping your desired version, images be made available and ready to run via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker import bidsonym_version_vX.Y.Z.tar
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">XYZ</span></code> is the version you downloaded, for example assuming <code class="docutils literal notranslate"><span class="pre">BIDSonym</span> <span class="pre">v0.0.4</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker import bidsonym_version_v0.0.4.tar
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="usage.html" class="btn btn-neutral float-right" title="Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="BIDSonym" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Peer Herholz.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>